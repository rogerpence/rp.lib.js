"use strict";var rp;(rp=rp||{}).ajax={},rp.ajax.HTTPRequest=class{constructor(){}submit(options){let fn=null,startTime=performance.now();options.hasOwnProperty("action")&&(fn=options.action,delete options.action),fetch(options.url,options).then(this.checkHTTPStatus).then(response=>"json"===options.dataType?response.json():"text"===options.dataType?response.text():"formData"===options.dataType?response.formData():"arrayBuffer"===options.dataType?response.arrayBuffer():void 0).then(data=>{"function"==typeof fn&&(data.__startTime=startTime,options.hasOwnProperty("context")?fn.call(options.context,data):fn(data))}).catch(error=>{console.log("There was an HTTP fetch error",error)})}checkHTTPStatus(response){if(response.ok)return response;let error=new Error(response.statusText);return error.response=response,Promise.reject(error)}},(rp=rp||{}).string=rp.string||{},rp.string.StringBuilder=class{constructor(){this.buffer=[]}append(str){this.buffer.push(str)}clear(){this.buffer=[]}toString(delimiter=""){return this.buffer.join(delimiter)}},(rp=rp||{}).dom=class{static findEl(selector){return selector.startsWith("#")?document.getElementById(selector.substring(1)):document.querySelector(selector)}static documentReady(fn){(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?fn():document.addEventListener("DOMContentLoaded",fn)}static elementLocation(el){if("string"==typeof el&&(el=document.getElementById(el)),!el)throw new Error("Element not found.");var rect=el.getBoundingClientRect(),scrollLeft=window.pageXOffset||document.documentElement.scrollLeft,scrollTop=window.pageYOffset||document.documentElement.scrollTop;return{top:rect.top+scrollTop,left:rect.left+scrollLeft,width:el.offsetWidth,height:el.offsetHeight}}static clearElementChildren(parent){let el;if(!(el="string"==typeof parent?document.getElementById(parent):parent))throw new Error("Element not found.");let range=document.createRange();range.selectNodeContents(el),range.deleteContents()}static setObjectDefaultValue(obj,key,value){obj.hasOwnProperty(key)||(obj[key]=value)}static removeElement(el){if("string"==typeof el&&(el=document.getElementById(el)),!el)throw new Error("el value wasn't found in removeElement.");el.parentElement.removeChild(el)}},(rp=rp||{}).AutoComplete=class{constructor(options){if(rp.dom.setObjectDefaultValue(options,"size",12),rp.dom.setObjectDefaultValue(options,"wait",300),rp.dom.setObjectDefaultValue(options,"display","text"),rp.dom.setObjectDefaultValue(options,"textField","text"),rp.dom.setObjectDefaultValue(options,"valueField","value"),rp.dom.setObjectDefaultValue(options,"selectClass",""),rp.dom.setObjectDefaultValue(options,"divClass",""),rp.dom.setObjectDefaultValue(options,"incrementalSearch",!1),options.selectId=options.itemInputId+"_select",this.options=options,this.options.ajaxAction=this.showList,!document.getElementById(this.options.selectId)){let sb=new rp.string.StringBuilder;sb.append(`<div class="${options.divClass}">`),sb.append(`<select class="${options.selectClass}"`),sb.append(' style="position:absolute;display:none;"'),sb.append(` data-input="${options.itemInputId}"`),sb.append(` id="${options.selectId}" size="${options.size}" />`),sb.append("</div"),document.body.insertAdjacentHTML("afterbegin",sb.toString())}this.itemInput=document.getElementById(options.itemInputId),this.itemInput.setAttribute("data-value",""),this.itemList=document.getElementById(options.selectId),this.timer=null,this.value=null,this.handlers={},this.assignEventhandlers()}showList(json){let list=[],textField=this.options.textField,valueField=this.options.valueField;for(var i=0;i<json.length;i++)list.push((text=json[i][textField],`<option data-value="${json[i][valueField]}">${text}</option>`));var text;list.length<this.options.size&&this.itemList.setAttribute("size",list.length),rp.dom.clearElementChildren(this.itemList),this.itemList.insertAdjacentHTML("afterbegin",list.join(""));let inputElementLocation=rp.dom.elementLocation(this.itemInput);this.itemList.style.left=inputElementLocation.left+"px",this.itemList.style.top=inputElementLocation.top+inputElementLocation.height+"px",this.itemList.style.width=inputElementLocation.width+"px",this.itemList.style.display="inline",this.itemList.selectedIndex=0,this.itemList.focus()}getList(searchValue){"function"==typeof this.options.onSetQueryString&&(searchValue=this.options.onSetQueryString(searchValue));let opts={url:this.options.url+searchValue,method:"GET",headers:new Headers({"content-type":"application/json","x-requested-with":"XMLHttpRequest"}),credentials:"same-origin",dataType:"json",action:this.options.ajaxAction,context:this};(new rp.ajax.HTTPRequest).submit(opts)}destroy(){this.itemInput.removeEventListener("keyup",this.handlers.onItemKeyUp),this.itemList.removeEventListener("click",this.handlers.onItemListClick),this.itemList.removeEventListener("change",this.handlers.onItemListChange),this.itemList.removeEventListener("keyup",this.handlers.onItemListKeyUp),this.itemList.removeEventListener("blur",this.handlers.onItemListBlur),rp.dom.removeElement(this.itemList)}assignItem(text,value){"function"==typeof this.options.onItemListDisplay?this.itemInput.value=this.options.onItemListDisplay(text,value):"text"==this.options.display?this.itemInput.value=text:this.itemInput.value=value,this.itemInput.setAttribute("data-value",value)}getSelectedTextAndValue(){let index=this.itemList.selectedIndex;-1===index&&(index=0);let opt=this.itemList.options[index],value=opt.dataset.value;return{text:opt.value,value:value}}assignEventhandlers(){let that=this;this.handlers.onItemKeyUp=function(e){9==e.keyCode&&""==e.target.value||(this.timer&&clearInterval(this.timer),this.timer=setTimeout(function(){that.getList(e.target.value)},that.options.wait))},this.handlers.onItemListClick=function(e){e.currentTarget.style.display="none"},this.handlers.onItemFocus=function(e){"function"==typeof that.options.onItemFocus&&that.options.onItemFocus()},this.handlers.onItemListChange=function(e){let sel=that.getSelectedTextAndValue();that.assignItem(sel.text,sel.value),"function"==typeof that.options.onItemListChange&&that.options.onItemListChange(sel.value)},this.handlers.onItemListKeyUp=function(e){if(e.keyCode>=65&&e.keyCode<=90)return that.itemInput.value=that.itemInput.value+String.fromCharCode(e.keyCode).toLocaleLowerCase(),e.preventDefault(),e.stopPropagation(),that.itemList.style.display="none",void(that.options.incrementalSearch?that.getList(that.itemInput.value):that.itemInput.focus());if(27==e.keyCode)return that.itemList.style.display="none",that.itemInput.value="",e.preventDefault(),e.stopPropagation(),void that.itemInput.focus();if(8==e.keyCode){let len=that.itemInput.value.length;return that.itemInput.value=that.itemInput.value.substring(0,len-1),e.preventDefault(),e.stopPropagation(),that.itemList.style.display="none",void(that.options.incrementalSearch?that.getList(that.itemInput.value):that.itemInput.focus())}},this.handlers.onItemListBlur=function(e){if("none"!==that.itemList.style.display){if(that.options.focusElementAfterSearch){let nextEl=document.getElementById(that.options.focusElementAfterSearch);nextEl&&nextEl.focus()}if(e.target.style.display="none","function"==typeof that.options.onItemListBlur){let sel=that.getSelectedTextAndValue();that.assignItem(sel.text,sel.value),that.options.onItemListBlur(sel.text,sel.value)}}else that.itemInput.focus()},this.itemInput.addEventListener("keyup",this.handlers.onItemKeyUp),this.itemInput.addEventListener("focus",this.handlers.onItemFocus),this.itemList.addEventListener("click",this.handlers.onItemListClick),this.itemList.addEventListener("change",this.handlers.onItemListChange),this.itemList.addEventListener("keyup",this.handlers.onItemListKeyUp),this.itemList.addEventListener("blur",this.handlers.onItemListBlur)}};